<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-zio-flow docs-doc-id-zflow">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Defining flows | ZIO</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/zio-flow/zflow"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-zio-flow-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-zio-flow-current"><meta data-rh="true" property="og:title" content="Defining flows | ZIO"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/zio-flow/zflow"><link data-rh="true" rel="alternate" href="https://zio.dev/zio-flow/zflow" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/zio-flow/zflow" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://IAX8GRSWEQ-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-237088290-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0HNKLNRT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SH0HNKLNRT",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
















































<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><link rel="stylesheet" href="/assets/css/styles.3ac761dc.css">
<link rel="preload" href="/assets/js/runtime~main.45d048c3.js" as="script">
<link rel="preload" href="/assets/js/main.c278ee17.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a class="navbar__item navbar__link" href="/reference/">Reference</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/ecosystem/">Ecosystem</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/overview/">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-flow/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zio-flow/zflow">Defining flows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-flow/remote">Remote</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-flow/activities">Activities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-flow/execution">Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-flow/backends">Backends</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-flow/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-flow/examples">Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-flow/internals">Internals</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Defining flows</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Defining flows</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>ZIO Flow is based on defining executable workflows as values of the type <code>ZFlow[R, E, A]</code>. This type is similar
to <code>ZIO[R, E, A]</code> in
that it represents a program as a value that can fail with the type <code>E</code> or succeed with the type <code>A</code>. The most important
difference is
that a <code>ZFlow</code> value is <em>serializable</em>, which means that it can be sent over the network for a remote <em>executor</em>.</p><p>When working with <code>ZFlow</code> programs, another core concept of ZIO Flow is <em>remote values</em>.
There <a href="/zio-flow/remote">is a separate section</a> about working
with remote values and remote functions. In this section we will focus on how to define flows and we can assume that
remote values and functions
work similarly to regular Scala values and functions.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="flow-control">Flow control<a class="hash-link" href="#flow-control" title="Direct link to heading">​</a></h2><p>The basic building blocks of defining a <code>ZFlow</code> workflow are similar to <code>ZIO</code>. We can use <code>succeed</code> or <code>fail</code> to create
a flow that finishes
with a result immediately:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">ZNothing</span><span class="token punctuation">,</span><span class="token plain"> durationInt</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">flow</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow1 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// flow1: ZFlow[Any, ZNothing, Int] = Return(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   value = Literal(value = Primitive(value = 100, standardType = int))</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow2 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// flow2: ZFlow[Any, String, ZNothing] = Fail(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   error = Literal(value = Primitive(value = &quot;Failed&quot;, standardType = string))</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the above code does not run anything; it just defines workflows as serializable values of the type <code>ZFlow</code>
that can be later sent
to an executor. In the future code examples we will not show the evaluated <code>ZFlow</code> values as they can be very verbose.</p><p>The usual <code>map</code>, <code>flatMap</code>, <code>as</code>, and variants of <code>zip</code> are all available on <code>ZFlow</code> so we can use <em>for comprehensions</em>
to define them:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow3 </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        a </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        b </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> a </span><span class="token operator">+</span><span class="token plain"> b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To handle failures we have <code>catchAll</code>, <code>orElse</code>, <code>foldFlow</code> and <code>ensuring</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow4 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain">ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;Flow 4 finished&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow5 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orElse</span><span class="token punctuation">(</span><span class="token plain">ZFlow</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow6 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZFlow</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Failed&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">failure</span><span class="token operator">:</span><span class="token plain"> Remote</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">      ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string-interpolation id function">rs</span><span class="token string-interpolation string">&quot;Failed with </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">failure</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="logging">Logging<a class="hash-link" href="#logging" title="Direct link to heading">​</a></h2><p>The simplest way to interact with the outside world from a ZIO Flow program is to log a message:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow7 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The logged message goes to the log output of the executor tagged by the running flow&#x27;s identifier.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="variables">Variables<a class="hash-link" href="#variables" title="Direct link to heading">​</a></h2><p>Persistent variables are named mutable slots belonging to a specific flow. They can be used to communicate between
different,
possibly parallel steps of a flow, and to expose some observable flow state for debugging purposes. They are similar to
the <code>Ref</code> data type in <code>ZIO</code>.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow8 </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    var1   </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">newVar</span><span class="token punctuation">(</span><span class="token string">&quot;var1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> var1</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token keyword">&lt;-</span><span class="token plain"> var1</span><span class="token punctuation">.</span><span class="token plain">get</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> result</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iteration-and-recursion">Iteration and recursion<a class="hash-link" href="#iteration-and-recursion" title="Direct link to heading">​</a></h2><p>There are multiple ways to repeat the execution of a flow.</p><p>The simplest one is <code>replicate</code> that repeats the flow a given number of times:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow9 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">replicate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A more complex way is using <code>iterate</code> which allows you to define a <em>step function</em> and a <em>condition</em>
and repeats the flow until the condition becomes true. The initial value is the flow&#x27;s result itself:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow10 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token operator">:</span><span class="token plain"> Remote</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> x </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">==</span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The result of the flow will be the final value of the iterated variable, in this case <code>10</code>. Note the use of the triple
equal operator (<code>===</code>) instead of the usual double (<code>==</code>). This is a limitation of the <em>remote types</em>,
covered <a href="/zio-flow/remote">in the next section</a>.</p><p>Another two operators on flows are <code>recurseSimple</code> and <code>recurse</code>. Why can&#x27;t we just write recursive Scala functions as
usual?
Let&#x27;s take the following example:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> recursiveFlow1</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> Remote</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZFlow</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZFlow</span><span class="token punctuation">.</span><span class="token plain">ifThenElse</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">==</span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ifTrue </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ifFalse </span><span class="token operator">=</span><span class="token plain"> recursiveFlow1</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow11Bad </span><span class="token operator">=</span><span class="token plain"> recursiveFlow1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that we cannot use Scala <code>if () {} else {}</code> expressions because they are not serializable. The <code>ifThenElse</code> method
defined on <code>Remote[Boolean]</code>
is an alternative of that, explained <a href="/zio-flow/remote">in the next section</a>.
Even though the above code compiles, it is not serializable! ZIO Flow has no way to detect that the call
to <code>recursiveFlow1</code> is a recursion point
and it would end up in a stack overflow.</p><p>The same example can be safely implemented by using the <code>recurseSimple</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow11Good </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZFlow</span><span class="token punctuation">.</span><span class="token plain">recurseSimple</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> ZNothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> rec</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZFlow</span><span class="token punctuation">.</span><span class="token plain">ifThenElse</span><span class="token punctuation">(</span><span class="token plain">value </span><span class="token operator">==</span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ifTrue </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ifFalse </span><span class="token operator">=</span><span class="token plain"> rec</span><span class="token punctuation">(</span><span class="token plain">value </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>recurse</code> is a slightly more complicated variant that allows the recursion body to have a different result type than the
initial value.
This usually requires specifying some type parameters by hand, so in simple cases <code>recurseSimple</code> leads to cleaner code.</p><p>ZIO Flow also has <code>foreach</code> and <code>foreachPar</code> to execute a flow for each element of a list:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow12 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> x </span><span class="token keyword">=&gt;</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string-interpolation id function">rs</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">toString</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow13 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">foreachPar</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> x </span><span class="token keyword">=&gt;</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string-interpolation id function">rs</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">toString</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fibers">Fibers<a class="hash-link" href="#fibers" title="Direct link to heading">​</a></h2><p>ZIO Flow programs can fork <em>fibers</em> for parallel execution, similar to how <code>ZIO</code> programs does it. The <code>fork</code> operator
returns
a value of <code>ExecutingFlow[E, A]</code> which can be used to await or interrupt the execution of the child fiber.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow14 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    fiber1 </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">5.</span><span class="token plain">minutes</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">    fiber2 </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">hour</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> fiber2</span><span class="token punctuation">.</span><span class="token plain">interrupt</span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> fiber2</span><span class="token punctuation">.</span><span class="token plain">await</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is often useful to <em>timeout</em> after a given duration, for example when waiting for a fiber to finish. This can be done
using the <code>timeout</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow15 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">hour</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">timeout</span><span class="token punctuation">(</span><span class="token number">10.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-external-world">The external world<a class="hash-link" href="#the-external-world" title="Direct link to heading">​</a></h2><p>There are other ways for ZIO Flow programs to communicate with the external world than just logging messages. The main
categories are:</p><ul><li>Getting an input for the execution of the flow</li><li>Accessing some built-in services such as time and random generator</li><li>Accessing external services</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="input">Input<a class="hash-link" href="#input" title="Direct link to heading">​</a></h3><p>ZIO Flow programs has a third type parameter, <code>R</code>, which was not used in the above examples. This represents the <em>input</em>
of the flow. When sending
a flow to an executor, if the R type is not <code>Any</code>, you also have to provide an input value of type <code>R</code> as a <em>parameter
of the execution</em>.</p><p>To access this value from the flow, we can use the <code>input</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow16 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">input</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// flow16: ZFlow[Int, ZNothing, Int] = Input()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the result type is now <code>ZFlow[Int, ZNothing, Int]</code>. The flow will <em>read the input</em>, and use it as its result.</p><p>When composing flows, you may want to eliminate the input requirement of a sub-flow. This can be done using
the <code>provide</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow17 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">input</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// flow17: ZFlow[Any, ZNothing, Int] = Provide(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   value = Literal(value = Primitive(value = 100, standardType = int)),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   flow = Input()</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The result type is now <code>ZFlow[Any, ZNothing, Int]</code>. This flow has no input requirement, and will always return <code>100</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="time">Time<a class="hash-link" href="#time" title="Direct link to heading">​</a></h3><p>Getting the current time is an important operation for ZIO Flow workflows because it allows time based schedules,
generating timestamps or expiration times, etc.</p><p>To get the current time as a remote value of <code>Instant</code>, use:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow18 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="random">Random<a class="hash-link" href="#random" title="Direct link to heading">​</a></h3><p>The flow may need to generate random values like random numbers, UUIDs etc. The <code>ZFlow</code> type has two random related
operators:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow19 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">random</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">double </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string-interpolation id function">rs</span><span class="token string-interpolation string">&quot;Random double: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">double</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">toString</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow20 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">randomUUID</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">uuid </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string-interpolation id function">rs</span><span class="token string-interpolation string">&quot;Random UUID: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">uuid</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">toString</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are higher level random functions exposed on <code>zio.flow.Random</code>, reflecting the ZIO <code>Random</code> service&#x27;s
functionalities:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow21 </span><span class="token operator">=</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextIntBetween</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow22 </span><span class="token operator">=</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="activities">Activities<a class="hash-link" href="#activities" title="Direct link to heading">​</a></h3><p>The primary way to communicate with the external world is by using <em>activities</em>. An activity is defined by the
type <code>Activity</code> and
it is a description of how to call an external service and how it should behave when it is used in <em>transactions</em>.
The <a href="/zio-flow/activities">activities</a>
section explains in detail how to define and use activities.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling">Scheduling<a class="hash-link" href="#scheduling" title="Direct link to heading">​</a></h2><p>We have seen that ZIO Flow programs can access the current time, and ways to repeat the execution of a part of the flow.
Often we want to
either delay the execution of something or repeat it at a given interval.</p><p>The two most simple operators are <code>sleep</code> and <code>waitTill</code>. Sleep will delay the execution of the flow for a given
duration:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow23 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">10.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>waitTill</code> operator will delay the execution of the flow until a given instant:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow24 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">waitTill</span><span class="token punctuation">(</span><span class="token plain">Instant</span><span class="token punctuation">.</span><span class="token plain">parse</span><span class="token punctuation">(</span><span class="token string">&quot;2022-12-12T10:00:00Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO Flow also defines a data type for describing more complex schedules. This type is <code>ZFlowSchedule</code> and it can be used
as a parameter to
the <code>schedule</code> and <code>repeat</code> opeators on <code>ZFlow</code>:</p><ul><li><code>schedule</code> will execute the flow once, according to the given schedule</li><li><code>repeat</code> will execute the flow immeditely and then repeat it according to the given schedule</li></ul><p>The following example logs a message every second:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow25 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token plain">ZFlowSchedule</span><span class="token punctuation">.</span><span class="token plain">fixed</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Other than fixed there are some other schedule contructors for defining hourly, daily or monthly schedules:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow26 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token plain">ZFlowSchedule</span><span class="token punctuation">.</span><span class="token plain">everyHourAt</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow27 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token plain">ZFlowSchedule</span><span class="token punctuation">.</span><span class="token plain">everyDayAt</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> flow28 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token plain">ZFlowSchedule</span><span class="token punctuation">.</span><span class="token plain">everyMonthAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is possible to define more complex schedules by using the <code>or</code> (or <code>|</code>) operator. The following example will log a
message every hour twice:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow29 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZFlowSchedule</span><span class="token punctuation">.</span><span class="token plain">everyHourAt</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> ZFlowSchedule</span><span class="token punctuation">.</span><span class="token plain">everyHourAt</span><span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation">)</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To limit the number of repetions of a schedule, use <code>maxCount</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow30 </span><span class="token operator">=</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZFlowSchedule</span><span class="token punctuation">.</span><span class="token plain">fixed</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">maxCount</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="transactions">Transactions<a class="hash-link" href="#transactions" title="Direct link to heading">​</a></h2><p>ZIO Flow programs can modify variables and perform <em>activities</em> in a <em>transactional way</em>. When transactions are used in
a single fiber, it guarantees that in case of failure all the undoable activities performed within the transactions are
rolled back.</p><p>To learn more about how activities can be rolled back <a href="/zio-flow/activities">check the activities page</a>.</p><p>When using transactions in parallel running ZFlow fibers, the transactions are also tracking the usage of remote variables.
If two transactional fibers are modifying the same variable, one of them will <em>retry</em> to make sure the whole transaction remains
consistent.</p><p>The following simple example shows how the traditional problem of parallel modification of a mutable variable can be solved using ZIO Flow transactions:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow31 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    var1 </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">newVar</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;var1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    now  </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">now</span><br></span><span class="token-line"><span class="token plain">    fib1 </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">transaction </span><span class="token punctuation">{</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        v1 </span><span class="token keyword">&lt;-</span><span class="token plain"> var1</span><span class="token punctuation">.</span><span class="token plain">get</span><br></span><span class="token-line"><span class="token plain">        _ </span><span class="token keyword">&lt;-</span><span class="token plain"> var1</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token plain">v1 </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">    fib2 </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">transaction </span><span class="token punctuation">{</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        v1 </span><span class="token keyword">&lt;-</span><span class="token plain"> var1</span><span class="token punctuation">.</span><span class="token plain">get</span><br></span><span class="token-line"><span class="token plain">        _ </span><span class="token keyword">&lt;-</span><span class="token plain"> var1</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token plain">v1 </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">    _  </span><span class="token keyword">&lt;-</span><span class="token plain"> fib1</span><span class="token punctuation">.</span><span class="token plain">await</span><br></span><span class="token-line"><span class="token plain">    _  </span><span class="token keyword">&lt;-</span><span class="token plain"> fib2</span><span class="token punctuation">.</span><span class="token plain">await</span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token keyword">&lt;-</span><span class="token plain"> var1</span><span class="token punctuation">.</span><span class="token plain">get</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> result</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will always return <code>12</code> because in case of conflict one of the transactions will be retried.</p><p>It is also possible to <em>conditionally retry</em> a transaction. By passing a remote boolean expression, the transaction will
evaluate the condition and in case it is <code>false</code> it will undo everything the transaction did and retry it. It also <em>suspends</em>
the execution of the retried transactions until any of the variables used in the transaction up to the evaluation of the condition
changes. This way it avoids repeated evaluation and failure of the flow.</p><p>The following example will retry the transaction two times:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> flow32 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    variable </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">newVar</span><span class="token punctuation">(</span><span class="token string">&quot;var&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    fiber </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">transaction </span><span class="token punctuation">{</span><span class="token plain"> tx </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">               </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                 value </span><span class="token keyword">&lt;-</span><span class="token plain"> variable</span><span class="token punctuation">.</span><span class="token plain">get</span><br></span><span class="token-line"><span class="token plain">                 _     </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction executed&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                 _     </span><span class="token keyword">&lt;-</span><span class="token plain"> tx</span><span class="token punctuation">.</span><span class="token plain">retryUntil</span><span class="token punctuation">(</span><span class="token plain">value </span><span class="token operator">==</span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">               </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> value</span><br></span><span class="token-line"><span class="token plain">             </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> variable</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> variable</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _      </span><span class="token keyword">&lt;-</span><span class="token plain"> ZFlow</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;Waiting for the transaction fiber to stop&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token keyword">&lt;-</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token plain">await</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> result</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zio-flow/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zio-flow/remote"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Remote</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#flow-control" class="table-of-contents__link toc-highlight">Flow control</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#variables" class="table-of-contents__link toc-highlight">Variables</a></li><li><a href="#iteration-and-recursion" class="table-of-contents__link toc-highlight">Iteration and recursion</a></li><li><a href="#fibers" class="table-of-contents__link toc-highlight">Fibers</a></li><li><a href="#the-external-world" class="table-of-contents__link toc-highlight">The external world</a><ul><li><a href="#input" class="table-of-contents__link toc-highlight">Input</a></li><li><a href="#time" class="table-of-contents__link toc-highlight">Time</a></li><li><a href="#random" class="table-of-contents__link toc-highlight">Random</a></li><li><a href="#activities" class="table-of-contents__link toc-highlight">Activities</a></li></ul></li><li><a href="#scheduling" class="table-of-contents__link toc-highlight">Scheduling</a></li><li><a href="#transactions" class="table-of-contents__link toc-highlight">Transactions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.45d048c3.js"></script>
<script src="/assets/js/main.c278ee17.js"></script>
</body>
</html>