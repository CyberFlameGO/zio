<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ecosystem/officials/zio-telemetry">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">ZIO Telemetry | ZIO</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/ecosystem/officials/zio-telemetry"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ZIO Telemetry | ZIO"><meta data-rh="true" name="description" content="ZIO telemetry is purely-functional and type-safe. It provides clients for OpenTracing and OpenTelemetry."><meta data-rh="true" property="og:description" content="ZIO telemetry is purely-functional and type-safe. It provides clients for OpenTracing and OpenTelemetry."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/ecosystem/officials/zio-telemetry"><link data-rh="true" rel="alternate" href="https://zio.dev/ecosystem/officials/zio-telemetry" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/ecosystem/officials/zio-telemetry" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://IAX8GRSWEQ-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-237088290-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0HNKLNRT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SH0HNKLNRT",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">

<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><link rel="stylesheet" href="/assets/css/styles.a6fccc19.css">
<link rel="preload" href="/assets/js/runtime~main.96c3eca1.js" as="script">
<link rel="preload" href="/assets/js/main.782618de.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/overview/getting-started">Overview</a><a class="navbar__item navbar__link" href="/reference/">Reference</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/ecosystem/">Ecosystem</a><a class="navbar__item navbar__link" href="/resources/">Resources</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/getting-started">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/ecosystem/officials/zio-telemetry">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: ZIO 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZIO Telemetry</h1></header><p><a href="https://github.com/zio/zio-telemetry" target="_blank" rel="noopener noreferrer">ZIO telemetry</a> is purely-functional and type-safe. It provides clients for OpenTracing and OpenTelemetry.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>In monolithic architecture, everything is in one place, and we know when a request starts and then how it goes through the components and when it finishes. We can obviously see what is happening with our request and where is it going. But, in distributed systems like microservice architecture, we cannot find out the story of a request through various services easily. This is where distributed tracing comes into play.</p><p>ZIO Telemetry is a purely functional client which helps up propagate context between services in a distributed environment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a class="hash-link" href="#installation" title="Direct link to heading">​</a></h2><p>In order to use this library, we need to add the following line in our <code>build.sbt</code> file if we want to use <a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">OpenTelemetry</a> client:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">libraryDependencies </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token string">&quot;dev.zio&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;zio-telemetry&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;0.8.1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And for using <a href="https://opentracing.io/" target="_blank" rel="noopener noreferrer">OpenTracing</a> client we should add the following line in our <code>build.sbt</code> file:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">libraryDependencies </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token string">&quot;dev.zio&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;zio-opentracing&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;0.8.1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">​</a></h2><p>In this example, we create two services, <code>ProxyServer</code> and <code>BackendServer</code>. When we call ProxyServer, the BackendServer will be called.</p><p>Note that we are going to use <em>OpenTracing</em> client for this example.</p><p>Here is a simplified diagram of our services:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">                               ┌────────────────┐</span><br></span><span class="token-line"><span class="token plain">                               │                │</span><br></span><span class="token-line"><span class="token plain">                        ┌─────►│ Jaeger Backend │◄────┐</span><br></span><span class="token-line"><span class="token plain">                        │      │                │     │</span><br></span><span class="token-line"><span class="token plain">           Tracing Data │      └────────────────┘     │ Tracing Data</span><br></span><span class="token-line"><span class="token plain">                        │                             │</span><br></span><span class="token-line"><span class="token plain">               ┌────────┴─────────┐         ┌─────────┴────────┐</span><br></span><span class="token-line"><span class="token plain">               │                  │         │                  │</span><br></span><span class="token-line"><span class="token plain">User Request──►│   Proxy Server   ├────────►|  Backend Server  │</span><br></span><span class="token-line"><span class="token plain">               │                  │         │                  │</span><br></span><span class="token-line"><span class="token plain">               └──────────────────┘         └──────────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>First of all we should add following dependencies to our <code>build.sbt</code> file:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> Versions </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> http4s         </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;0.21.24&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> jaeger         </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;1.6.0&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sttp           </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;2.2.9&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> opentracing    </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;0.33.0&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> opentelemetry  </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;1.4.1&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> opencensus     </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;0.28.3&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> zipkin         </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;2.16.3&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> zio            </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;1.0.9&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> zioInteropCats </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;2.5.1.0&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> openTracingExample </span><span class="token operator">=</span><span class="token plain"> Seq</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;org.typelevel&quot;</span><span class="token plain">                </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;cats-core&quot;</span><span class="token plain">                     </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;2.6.1&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;io.circe&quot;</span><span class="token plain">                     </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;circe-generic&quot;</span><span class="token plain">                 </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;0.14.1&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;org.http4s&quot;</span><span class="token plain">                   </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;http4s-core&quot;</span><span class="token plain">                   </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">http4s</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;org.http4s&quot;</span><span class="token plain">                   </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;http4s-blaze-server&quot;</span><span class="token plain">           </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">http4s</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;org.http4s&quot;</span><span class="token plain">                   </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;http4s-dsl&quot;</span><span class="token plain">                    </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">http4s</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;org.http4s&quot;</span><span class="token plain">                   </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;http4s-circe&quot;</span><span class="token plain">                  </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">http4s</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;io.jaegertracing&quot;</span><span class="token plain">              </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;jaeger-core&quot;</span><span class="token plain">                   </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">jaeger</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;io.jaegertracing&quot;</span><span class="token plain">              </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;jaeger-client&quot;</span><span class="token plain">                 </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">jaeger</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;io.jaegertracing&quot;</span><span class="token plain">              </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;jaeger-zipkin&quot;</span><span class="token plain">                 </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">jaeger</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;com.github.pureconfig&quot;</span><span class="token plain">        </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;pureconfig&quot;</span><span class="token plain">                    </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;0.16.0&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;com.softwaremill.sttp.client&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;async-http-client-backend-zio&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">sttp</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;com.softwaremill.sttp.client&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;circe&quot;</span><span class="token plain">                         </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">sttp</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;dev.zio&quot;</span><span class="token plain">                      </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;zio-interop-cats&quot;</span><span class="token plain">              </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">zioInteropCats</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;io.zipkin.reporter2&quot;</span><span class="token plain">           </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;zipkin-reporter&quot;</span><span class="token plain">               </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">zipkin</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;io.zipkin.reporter2&quot;</span><span class="token plain">           </span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;zipkin-sender-okhttp3&quot;</span><span class="token plain">         </span><span class="token operator">%</span><span class="token plain"> Versions</span><span class="token punctuation">.</span><span class="token plain">zipkin</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s create a <code>ZLayer</code> for <code>OpenTracing</code> which provides us Jaeger tracer. Each microservice uses this dependency to send its tracing data to the <em>Jaeger Backend</em>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token namespace">jaegertracing</span><span class="token namespace punctuation">.</span><span class="token plain">Configuration</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token namespace">jaegertracing</span><span class="token namespace punctuation">.</span><span class="token namespace">internal</span><span class="token namespace punctuation">.</span><span class="token namespace">samplers</span><span class="token namespace punctuation">.</span><span class="token plain">ConstSampler</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token namespace">jaegertracing</span><span class="token namespace punctuation">.</span><span class="token namespace">zipkin</span><span class="token namespace punctuation">.</span><span class="token plain">ZipkinV2Reporter</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">apache</span><span class="token namespace punctuation">.</span><span class="token namespace">http</span><span class="token namespace punctuation">.</span><span class="token namespace">client</span><span class="token namespace punctuation">.</span><span class="token namespace">utils</span><span class="token namespace punctuation">.</span><span class="token plain">URIBuilder</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">ZLayer</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">clock</span><span class="token namespace punctuation">.</span><span class="token plain">Clock</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">telemetry</span><span class="token namespace punctuation">.</span><span class="token namespace">opentracing</span><span class="token namespace punctuation">.</span><span class="token plain">OpenTracing</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zipkin2</span><span class="token namespace punctuation">.</span><span class="token namespace">reporter</span><span class="token namespace punctuation">.</span><span class="token plain">AsyncReporter</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zipkin2</span><span class="token namespace punctuation">.</span><span class="token namespace">reporter</span><span class="token namespace punctuation">.</span><span class="token namespace">okhttp3</span><span class="token namespace punctuation">.</span><span class="token plain">OkHttpSender</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> JaegerTracer </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> makeJaegerTracer</span><span class="token punctuation">(</span><span class="token plain">host</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> serviceName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZLayer</span><span class="token punctuation">[</span><span class="token plain">Clock</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Clock </span><span class="token keyword">with</span><span class="token plain"> OpenTracing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    OpenTracing</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Configuration</span><span class="token punctuation">(</span><span class="token plain">serviceName</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">getTracerBuilder</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">withSampler</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> ConstSampler</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">withReporter</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">new</span><span class="token plain"> ZipkinV2Reporter</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          AsyncReporter</span><span class="token punctuation">.</span><span class="token plain">create</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            OkHttpSender</span><span class="token punctuation">.</span><span class="token plain">newBuilder</span><br></span><span class="token-line"><span class="token plain">              </span><span class="token punctuation">.</span><span class="token plain">compressionEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token punctuation">.</span><span class="token plain">endpoint</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                </span><span class="token keyword">new</span><span class="token plain"> URIBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  </span><span class="token punctuation">.</span><span class="token plain">setScheme</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  </span><span class="token punctuation">.</span><span class="token plain">setHost</span><span class="token punctuation">(</span><span class="token plain">host</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  </span><span class="token punctuation">.</span><span class="token plain">setPath</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v2/spans&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  </span><span class="token punctuation">.</span><span class="token plain">build</span><span class="token punctuation">.</span><span class="token plain">toString</span><br></span><span class="token-line"><span class="token plain">              </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token punctuation">.</span><span class="token plain">build</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">build</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> Clock</span><span class="token punctuation">.</span><span class="token plain">live</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <em>BackendServer</em>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token namespace">opentracing</span><span class="token namespace punctuation">.</span><span class="token namespace">propagation</span><span class="token namespace punctuation">.</span><span class="token plain">Format</span><span class="token punctuation">.</span><span class="token plain">Builtin</span><span class="token punctuation">.</span><span class="token punctuation">{</span><span class="token plain">HTTP_HEADERS </span><span class="token keyword">=&gt;</span><span class="token plain"> HttpHeadersFormat</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token namespace">opentracing</span><span class="token namespace punctuation">.</span><span class="token namespace">propagation</span><span class="token namespace punctuation">.</span><span class="token plain">TextMapAdapter</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token namespace">dsl</span><span class="token namespace punctuation">.</span><span class="token plain">Http4sDsl</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token namespace">server</span><span class="token namespace punctuation">.</span><span class="token plain">Router</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token namespace">server</span><span class="token namespace punctuation">.</span><span class="token namespace">blaze</span><span class="token namespace punctuation">.</span><span class="token plain">BlazeServerBuilder</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token namespace">syntax</span><span class="token namespace punctuation">.</span><span class="token namespace">kleisli</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">clock</span><span class="token namespace punctuation">.</span><span class="token plain">Clock</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">interop</span><span class="token namespace punctuation">.</span><span class="token namespace">catz</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">telemetry</span><span class="token namespace punctuation">.</span><span class="token namespace">opentracing</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> JaegerTracer</span><span class="token punctuation">.</span><span class="token plain">makeJaegerTracer</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">ExitCode</span><span class="token punctuation">,</span><span class="token plain"> ZEnv</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">jdk</span><span class="token namespace punctuation">.</span><span class="token plain">CollectionConverters</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> BackendServer </span><span class="token keyword">extends</span><span class="token plain"> CatsApp </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">type</span><span class="token plain"> AppTask</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Clock</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> dsl</span><span class="token operator">:</span><span class="token plain"> Http4sDsl</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> Http4sDsl</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">dsl</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> run</span><span class="token punctuation">(</span><span class="token plain">args</span><span class="token operator">:</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ZEnv</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> ExitCode</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">runtime</span><span class="token punctuation">[</span><span class="token plain">Clock</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">implicit</span><span class="token plain"> runtime </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      BlazeServerBuilder</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">runtime</span><span class="token punctuation">.</span><span class="token plain">platform</span><span class="token punctuation">.</span><span class="token plain">executor</span><span class="token punctuation">.</span><span class="token plain">asEC</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">bindHttp</span><span class="token punctuation">(</span><span class="token plain">port </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">9000</span><span class="token punctuation">,</span><span class="token plain"> host </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">withHttpApp</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          Router</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">mappings </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;/&quot;</span><span class="token plain"> </span><span class="token operator">-&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            HttpRoutes</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> request</span><span class="token annotation punctuation">@GET</span><span class="token plain"> </span><span class="token operator">-&gt;</span><span class="token plain"> Root </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">                </span><span class="token punctuation">.</span><span class="token plain">spanFrom</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  format </span><span class="token operator">=</span><span class="token plain"> HttpHeadersFormat</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  carrier </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> TextMapAdapter</span><span class="token punctuation">(</span><span class="token plain">request</span><span class="token punctuation">.</span><span class="token plain">headers</span><span class="token punctuation">.</span><span class="token plain">toList</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">h </span><span class="token keyword">=&gt;</span><span class="token plain"> h</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">.</span><span class="token plain">value </span><span class="token operator">-&gt;</span><span class="token plain"> h</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">toMap</span><span class="token punctuation">.</span><span class="token plain">asJava</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  operation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;GET /&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                </span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">makeJaegerTracer</span><span class="token punctuation">(</span><span class="token plain">host </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;0.0.0.0:9411&quot;</span><span class="token punctuation">,</span><span class="token plain"> serviceName </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;backend-service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Ok</span><span class="token punctuation">(</span><span class="token string">&quot;Ok!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orNotFound</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">serve</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">compile</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">drain</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">exitCode</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the <em>ProxyServer</em> which calls the <em>BackendServer</em>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">cats</span><span class="token namespace punctuation">.</span><span class="token namespace">effect</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">ExitCode </span><span class="token keyword">=&gt;</span><span class="token plain"> catsExitCode</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token namespace">opentracing</span><span class="token namespace punctuation">.</span><span class="token namespace">propagation</span><span class="token namespace punctuation">.</span><span class="token plain">Format</span><span class="token punctuation">.</span><span class="token plain">Builtin</span><span class="token punctuation">.</span><span class="token punctuation">{</span><span class="token plain">HTTP_HEADERS </span><span class="token keyword">=&gt;</span><span class="token plain"> HttpHeadersFormat</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token namespace">opentracing</span><span class="token namespace punctuation">.</span><span class="token namespace">propagation</span><span class="token namespace punctuation">.</span><span class="token plain">TextMapAdapter</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token namespace">opentracing</span><span class="token namespace punctuation">.</span><span class="token namespace">tag</span><span class="token namespace punctuation">.</span><span class="token plain">Tags</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token plain">HttpRoutes</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token namespace">dsl</span><span class="token namespace punctuation">.</span><span class="token plain">Http4sDsl</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token namespace">server</span><span class="token namespace punctuation">.</span><span class="token plain">Router</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token namespace">server</span><span class="token namespace punctuation">.</span><span class="token namespace">blaze</span><span class="token namespace punctuation">.</span><span class="token plain">BlazeServerBuilder</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">org</span><span class="token namespace punctuation">.</span><span class="token namespace">http4s</span><span class="token namespace punctuation">.</span><span class="token namespace">syntax</span><span class="token namespace punctuation">.</span><span class="token namespace">kleisli</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">sttp</span><span class="token namespace punctuation">.</span><span class="token namespace">client</span><span class="token namespace punctuation">.</span><span class="token namespace">asynchttpclient</span><span class="token namespace punctuation">.</span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">AsyncHttpClientZioBackend</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">sttp</span><span class="token namespace punctuation">.</span><span class="token namespace">client</span><span class="token namespace punctuation">.</span><span class="token namespace">basicRequest</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">sttp</span><span class="token namespace punctuation">.</span><span class="token namespace">model</span><span class="token namespace punctuation">.</span><span class="token plain">Uri</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">clock</span><span class="token namespace punctuation">.</span><span class="token plain">Clock</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">interop</span><span class="token namespace punctuation">.</span><span class="token namespace">catz</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">telemetry</span><span class="token namespace punctuation">.</span><span class="token namespace">opentracing</span><span class="token namespace punctuation">.</span><span class="token plain">OpenTracing</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> JaegerTracer</span><span class="token punctuation">.</span><span class="token plain">makeJaegerTracer</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">ExitCode</span><span class="token punctuation">,</span><span class="token plain"> UIO</span><span class="token punctuation">,</span><span class="token plain"> ZEnv</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">collection</span><span class="token namespace punctuation">.</span><span class="token namespace">mutable</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">jdk</span><span class="token namespace punctuation">.</span><span class="token plain">CollectionConverters</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> ProxyServer </span><span class="token keyword">extends</span><span class="token plain"> CatsApp </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">type</span><span class="token plain"> AppTask</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Clock</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">private</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> backend </span><span class="token operator">=</span><span class="token plain"> AsyncHttpClientZioBackend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> run</span><span class="token punctuation">(</span><span class="token plain">args</span><span class="token operator">:</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">ZEnv</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> ExitCode</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">runtime</span><span class="token punctuation">[</span><span class="token plain">Clock</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">implicit</span><span class="token plain"> runtime </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">implicit</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> ec </span><span class="token operator">=</span><span class="token plain"> runtime</span><span class="token punctuation">.</span><span class="token plain">platform</span><span class="token punctuation">.</span><span class="token plain">executor</span><span class="token punctuation">.</span><span class="token plain">asEC</span><br></span><span class="token-line"><span class="token plain">      BlazeServerBuilder</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">ec</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">bindHttp</span><span class="token punctuation">(</span><span class="token plain">port </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token plain"> host </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">withHttpApp</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          Router</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">mappings </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;/&quot;</span><span class="token plain"> </span><span class="token operator">-&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token keyword">val</span><span class="token plain"> dsl</span><span class="token operator">:</span><span class="token plain"> Http4sDsl</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> Http4sDsl</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">dsl</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">            HttpRoutes</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> GET </span><span class="token operator">-&gt;</span><span class="token plain"> Root </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                _ </span><span class="token keyword">&lt;-</span><span class="token plain"> OpenTracing</span><span class="token punctuation">.</span><span class="token plain">tag</span><span class="token punctuation">(</span><span class="token plain">Tags</span><span class="token punctuation">.</span><span class="token plain">SPAN_KIND</span><span class="token punctuation">.</span><span class="token plain">getKey</span><span class="token punctuation">,</span><span class="token plain"> Tags</span><span class="token punctuation">.</span><span class="token plain">SPAN_KIND_CLIENT</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                _ </span><span class="token keyword">&lt;-</span><span class="token plain"> OpenTracing</span><span class="token punctuation">.</span><span class="token plain">tag</span><span class="token punctuation">(</span><span class="token plain">Tags</span><span class="token punctuation">.</span><span class="token plain">HTTP_METHOD</span><span class="token punctuation">.</span><span class="token plain">getKey</span><span class="token punctuation">,</span><span class="token plain"> GET</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                _ </span><span class="token keyword">&lt;-</span><span class="token plain"> OpenTracing</span><span class="token punctuation">.</span><span class="token plain">setBaggageItem</span><span class="token punctuation">(</span><span class="token string">&quot;proxy-baggage-item-key&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;proxy-baggage-item-value&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                buffer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> TextMapAdapter</span><span class="token punctuation">(</span><span class="token plain">mutable</span><span class="token punctuation">.</span><span class="token plain">Map</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">asJava</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                _ </span><span class="token keyword">&lt;-</span><span class="token plain"> OpenTracing</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">HttpHeadersFormat</span><span class="token punctuation">,</span><span class="token plain"> buffer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                headers </span><span class="token keyword">&lt;-</span><span class="token plain"> extractHeaders</span><span class="token punctuation">(</span><span class="token plain">buffer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                res </span><span class="token keyword">&lt;-</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  backend</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">implicit</span><span class="token plain"> backend </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                    basicRequest</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token plain">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">path</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">headers</span><span class="token punctuation">(</span><span class="token plain">headers</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">body</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                    </span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                      </span><span class="token keyword">case</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Ok</span><span class="token punctuation">(</span><span class="token string">&quot;Ok!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                      </span><span class="token keyword">case</span><span class="token plain"> Left</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Ok</span><span class="token punctuation">(</span><span class="token string">&quot;Oops!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> res</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                </span><span class="token punctuation">.</span><span class="token plain">root</span><span class="token punctuation">(</span><span class="token plain">operation </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;GET /&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                </span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                  makeJaegerTracer</span><span class="token punctuation">(</span><span class="token plain">host </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;0.0.0.0:9411&quot;</span><span class="token punctuation">,</span><span class="token plain"> serviceName </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;proxy-server&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orNotFound</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">serve</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">compile</span><span class="token punctuation">[</span><span class="token plain">AppTask</span><span class="token punctuation">,</span><span class="token plain"> AppTask</span><span class="token punctuation">,</span><span class="token plain"> catsExitCode</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">drain</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token plain">ExitCode</span><span class="token punctuation">.</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">exitCode</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">private</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> extractHeaders</span><span class="token punctuation">(</span><span class="token plain">adapter</span><span class="token operator">:</span><span class="token plain"> TextMapAdapter</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token plain">Map</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">val</span><span class="token plain"> m </span><span class="token operator">=</span><span class="token plain"> mutable</span><span class="token punctuation">.</span><span class="token plain">Map</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    UIO</span><span class="token punctuation">(</span><span class="token plain">adapter</span><span class="token punctuation">.</span><span class="token plain">forEach </span><span class="token punctuation">{</span><span class="token plain"> entry </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      m</span><span class="token punctuation">.</span><span class="token plain">put</span><span class="token punctuation">(</span><span class="token plain">entry</span><span class="token punctuation">.</span><span class="token plain">getKey</span><span class="token punctuation">,</span><span class="token plain"> entry</span><span class="token punctuation">.</span><span class="token plain">getValue</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token plain">m</span><span class="token punctuation">.</span><span class="token plain">toMap</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>First, we run the following command to start Jaeger backend:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token function">docker</span><span class="token plain"> run -d --name jaeger </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  -e </span><span class="token assign-left variable">COLLECTOR_ZIPKIN_HTTP_PORT</span><span class="token operator">=</span><span class="token number">9411</span><span class="token plain"> </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  -p </span><span class="token number">5775</span><span class="token plain">:5775/udp </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  -p </span><span class="token number">6831</span><span class="token plain">:6831/udp </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  -p </span><span class="token number">6832</span><span class="token plain">:6832/udp </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  -p </span><span class="token number">5778</span><span class="token plain">:5778 </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  -p </span><span class="token number">16686</span><span class="token plain">:16686 </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  -p </span><span class="token number">14268</span><span class="token plain">:14268 </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  -p </span><span class="token number">9411</span><span class="token plain">:9411 </span><span class="token punctuation">\</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  jaegertracing/all-in-one:1.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s time to run Backend and Proxy servers. After starting these two, we can start calling <code>ProxyServer</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">curl </span><span class="token operator">-</span><span class="token plain">X GET http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">8080</span><span class="token operator">/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can check the Jaeger service (http://localhost:16686/) to see the result.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="articles">Articles<a class="hash-link" href="#articles" title="Direct link to heading">​</a></h2><ul><li><a href="https://kadek-marek.medium.com/trace-your-microservices-with-zio-telemetry-5f88d69cb26b" target="_blank" rel="noopener noreferrer">Trace your microservices with ZIO</a> by Marek Kadek (September 2021)</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/ecosystem/officials/zio-telemetry.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#articles" class="table-of-contents__link toc-highlight">Articles</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.96c3eca1.js"></script>
<script src="/assets/js/main.782618de.js"></script>
</body>
</html>